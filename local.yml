- hosts: localhost
  connection: local
  become: yes
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Configure git (avoid interactive prompts)
      shell: |
        git config --global user.email "ansible@localhost" || true
        git config --global user.name "Ansible" || true
      become: no
        
    - name: Install essential packages
      apt:
        name:
          - vim
          - git
          - htop
          - firefox-esr
          - luanti
          - 0ad
        state: present

    - name: Add user to sudoers
      user:
        name: user
        groups: sudo
        append: yes
      ignore_errors: yes  # In case user doesn't exist

        #- name: Clone/update dotfiles repo
        #git:
        #repo: https://github.com/mikeizbicki/dotfiles
        #dest: "/home/user"
        #version: dotfiles
        #force: yes
        #become: no

    - name: Copy dotfiles to home directory
      shell: |
        cd {{ ansible_env.HOME }}
        cp -r dotfiles-temp/. .
        rm -rf dotfiles-temp
      become: no
